var h=class{constructor(){this.structure={}}initialize(t){this.structure=JSON.parse(JSON.stringify(t))}applyDiff(t){for(let[e,s]of t){if(!this.structure[e]){console.warn(`[Arizona] StatefulId ${e} not found in structure`);continue}for(let[n,r]of s)this.structure[e][n]=r}}generateHTML(t="root"){let e=this.structure[t];if(!e)return"";let s=[],n=Object.keys(e).map(r=>parseInt(r)).sort((r,i)=>r-i);for(let r of n){let i=e[r];typeof i=="string"?s.push(i):i&&i.type==="stateful"?s.push(this.generateHTML(i.id)):i&&i.type==="stateless"?s.push(this.generateHTMLFromStructure(i.structure)):i&&i.type==="list"?s.push(this.generateListHTML(i)):Array.isArray(i)?s.push(this.flattenIoData(i)):s.push(String(i))}return s.join("")}flattenIoData(t){return typeof t=="string"?t:typeof t=="number"?String(t):Array.isArray(t)?t.map(e=>this.flattenIoData(e)).join(""):t&&typeof t=="object"?t.type==="stateful"?this.generateHTML(t.id):t.type==="stateless"?this.generateHTMLFromStructure(t.structure):t.type==="list"?this.generateListHTML(t):String(t):String(t||"")}generateHTMLFromStructure(t){let e=[],s=Object.keys(t).map(n=>parseInt(n)).sort((n,r)=>n-r);for(let n of s){let r=t[n];typeof r=="string"?e.push(r):Array.isArray(r)?e.push(this.flattenIoData(r)):e.push(String(r))}return e.join("")}generateListHTML(t){let{static:e,dynamic:s}=t,n=[];for(let r of s){let i=[],f=Object.keys(r).map(o=>parseInt(o)).sort((o,p)=>o-p),a=0;for(let o of f)a<e.length&&(i.push(e[a]),a++),i.push(String(r[o]));for(;a<e.length;)i.push(e[a]),a++;n.push(i.join(""))}return n.join("")}getStructure(){return JSON.parse(JSON.stringify(this.structure))}isInitialized(){return Object.keys(this.structure).length>0}getComponent(t){return this.structure[t]||null}hasComponent(t){return t in this.structure}getComponentIds(){return Object.keys(this.structure)}clear(){this.structure={}}createPatch(t="root"){return{type:"html_patch",statefulId:t,html:this.generateHTML(t),timestamp:Date.now()}}createInitialPatch(t="root"){return{type:"initial_render",statefulId:t,html:this.generateHTML(t),structure:this.getStructure(),timestamp:Date.now()}}static validateStructure(t){if(!t||typeof t!="object")return!1;for(let[e,s]of Object.entries(t)){if(!s||typeof s!="object")return!1;let n=Object.keys(s);for(let r of n)if(isNaN(parseInt(r)))return!1}return!0}static validateDiff(t){if(!Array.isArray(t))return!1;for(let e of t){if(!Array.isArray(e)||e.length!==2)return!1;let[s,n]=e;if(typeof s!="string"||!Array.isArray(n))return!1;for(let r of n){if(!Array.isArray(r)||r.length!==2)return!1;let[i]=r;if(isNaN(parseInt(i)))return!1}}return!0}};var c=h;var u=class{constructor(){this.socket=null,this.connected=!1,this.messageQueue=[],this.hierarchical=new c,self.onmessage=t=>{let{type:e,data:s}=t.data;switch(e){case"connect":this.connect(s.url);break;case"send":this.sendMessage(s);break;case"disconnect":this.disconnect();break}}}connect(t){this.connected||(this.socket=new WebSocket(t),this.socket.onopen=()=>{this.connected=!0,this.postMessage({type:"status",data:{status:"connected"}}),this.flushMessageQueue()},this.socket.onmessage=e=>{let s=JSON.parse(e.data);this.handleWebSocketMessage(s)},this.socket.onclose=()=>{this.connected=!1,this.postMessage({type:"status",data:{status:"disconnected"}})},this.socket.onerror=e=>{this.postMessage({type:"error",data:{error:e.toString()}})})}sendMessage(t){let e=JSON.stringify(t);this.connected&&this.socket.readyState===WebSocket.OPEN?this.socket.send(e):this.messageQueue.push(e)}flushMessageQueue(){for(;this.messageQueue.length>0;){let t=this.messageQueue.shift();if(this.socket.readyState===WebSocket.OPEN)this.socket.send(t);else{this.messageQueue.unshift(t);break}}}disconnect(){this.socket&&(this.socket.close(),this.socket=null),this.connected=!1,this.hierarchical.clear()}handleWebSocketMessage(t){try{switch(t.type){case"initial_render":this.handleInitialRender(t);break;case"diff":this.handleDiff(t);break;default:this.postMessage({type:"message",data:t});break}}catch(e){console.error("[Arizona Worker] Error handling message:",e),this.postMessage({type:"error",data:{error:`Message handling failed: ${e.message}`}})}}handleInitialRender(t){if(!c.validateStructure(t.structure))throw new Error("Invalid hierarchical structure format");this.hierarchical.initialize(t.structure);let e=this.hierarchical.createInitialPatch();this.postMessage({type:"html_patch",data:{patch:e,isInitial:!0}}),console.log("[Arizona Worker] Initial render processed")}handleDiff(t){if(!c.validateDiff(t.changes))throw new Error("Invalid diff changes format");if(!this.hierarchical.isInitialized())throw new Error("Hierarchical structure not initialized");this.hierarchical.applyDiff(t.changes);let e=this.hierarchical.createPatch();this.postMessage({type:"html_patch",data:{patch:e,isInitial:!1}}),console.log("[Arizona Worker] Diff applied and patch sent")}getHierarchicalState(){return{initialized:this.hierarchical.isInitialized(),componentIds:this.hierarchical.getComponentIds(),structure:this.hierarchical.getStructure()}}postMessage(t){self.postMessage(t)}};new u;
//# sourceMappingURL=arizona-worker.min.js.map
