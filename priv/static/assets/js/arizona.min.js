var Q=11;function le(r,e){var t=e.attributes,n,a,c,h,v;if(!(e.nodeType===Q||r.nodeType===Q)){for(var b=t.length-1;b>=0;b--)n=t[b],a=n.name,c=n.namespaceURI,h=n.value,c?(a=n.localName||a,v=r.getAttributeNS(c,a),v!==h&&(n.prefix==="xmlns"&&(a=n.name),r.setAttributeNS(c,a,h))):(v=r.getAttribute(a),v!==h&&r.setAttribute(a,h));for(var T=r.attributes,y=T.length-1;y>=0;y--)n=T[y],a=n.name,c=n.namespaceURI,c?(a=n.localName||a,e.hasAttributeNS(c,a)||r.removeAttributeNS(c,a)):e.hasAttribute(a)||r.removeAttribute(a)}}var _,de="http://www.w3.org/1999/xhtml",u=typeof document>"u"?void 0:document,ce=!!u&&"content"in u.createElement("template"),oe=!!u&&u.createRange&&"createContextualFragment"in u.createRange();function he(r){var e=u.createElement("template");return e.innerHTML=r,e.content.childNodes[0]}function fe(r){_||(_=u.createRange(),_.selectNode(u.body));var e=_.createContextualFragment(r);return e.childNodes[0]}function ue(r){var e=u.createElement("body");return e.innerHTML=r,e.childNodes[0]}function ve(r){return r=r.trim(),ce?he(r):oe?fe(r):ue(r)}function D(r,e){var t=r.nodeName,n=e.nodeName,a,c;return t===n?!0:(a=t.charCodeAt(0),c=n.charCodeAt(0),a<=90&&c>=97?t===n.toUpperCase():c<=90&&a>=97?n===t.toUpperCase():!1)}function pe(r,e){return!e||e===de?u.createElement(r):u.createElementNS(e,r)}function ge(r,e){for(var t=r.firstChild;t;){var n=t.nextSibling;e.appendChild(t),t=n}return e}function F(r,e,t){r[t]!==e[t]&&(r[t]=e[t],r[t]?r.setAttribute(t,""):r.removeAttribute(t))}var Y={OPTION:function(r,e){var t=r.parentNode;if(t){var n=t.nodeName.toUpperCase();n==="OPTGROUP"&&(t=t.parentNode,n=t&&t.nodeName.toUpperCase()),n==="SELECT"&&!t.hasAttribute("multiple")&&(r.hasAttribute("selected")&&!e.selected&&(r.setAttribute("selected","selected"),r.removeAttribute("selected")),t.selectedIndex=-1)}F(r,e,"selected")},INPUT:function(r,e){F(r,e,"checked"),F(r,e,"disabled"),r.value!==e.value&&(r.value=e.value),e.hasAttribute("value")||r.removeAttribute("value")},TEXTAREA:function(r,e){var t=e.value;r.value!==t&&(r.value=t);var n=r.firstChild;if(n){var a=n.nodeValue;if(a==t||!t&&a==r.placeholder)return;n.nodeValue=t}},SELECT:function(r,e){if(!e.hasAttribute("multiple")){for(var t=-1,n=0,a=r.firstChild,c,h;a;)if(h=a.nodeName&&a.nodeName.toUpperCase(),h==="OPTGROUP")c=a,a=c.firstChild,a||(a=c.nextSibling,c=null);else{if(h==="OPTION"){if(a.hasAttribute("selected")){t=n;break}n++}a=a.nextSibling,!a&&c&&(a=c.nextSibling,c=null)}r.selectedIndex=t}}},N=1,J=11,Z=3,ee=8;function A(){}function we(r){if(r)return r.getAttribute&&r.getAttribute("id")||r.id}function Ae(r){return function(t,n,a){if(a||(a={}),typeof n=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var c=n;n=u.createElement("html"),n.innerHTML=c}else n=ve(n);else n.nodeType===J&&(n=n.firstElementChild);var h=a.getNodeKey||we,v=a.onBeforeNodeAdded||A,b=a.onNodeAdded||A,T=a.onBeforeElUpdated||A,y=a.onElUpdated||A,H=a.onBeforeNodeDiscarded||A,M=a.onNodeDiscarded||A,ne=a.onBeforeElChildrenUpdated||A,re=a.skipFromChildren||A,K=a.addChild||function(i,s){return i.appendChild(s)},z=a.childrenOnly===!0,S=Object.create(null),O=[];function P(i){O.push(i)}function X(i,s){if(i.nodeType===N)for(var o=i.firstChild;o;){var l=void 0;s&&(l=h(o))?P(l):(M(o),o.firstChild&&X(o,s)),o=o.nextSibling}}function R(i,s,o){H(i)!==!1&&(s&&s.removeChild(i),M(i),X(i,o))}function $(i){if(i.nodeType===N||i.nodeType===J)for(var s=i.firstChild;s;){var o=h(s);o&&(S[o]=s),$(s),s=s.nextSibling}}$(t);function V(i){b(i);for(var s=i.firstChild;s;){var o=s.nextSibling,l=h(s);if(l){var d=S[l];d&&D(s,d)?(s.parentNode.replaceChild(d,s),L(d,s)):V(s)}else V(s);s=o}}function ae(i,s,o){for(;s;){var l=s.nextSibling;(o=h(s))?P(o):R(s,i,!0),s=l}}function L(i,s,o){var l=h(s);if(l&&delete S[l],!o){var d=T(i,s);if(d===!1||(d instanceof HTMLElement&&(i=d,$(i)),r(i,s),y(i),ne(i,s)===!1))return}i.nodeName!=="TEXTAREA"?ie(i,s):Y.TEXTAREA(i,s)}function ie(i,s){var o=re(i,s),l=s.firstChild,d=i.firstChild,k,p,m,E,g;e:for(;l;){for(E=l.nextSibling,k=h(l);!o&&d;){if(m=d.nextSibling,l.isSameNode&&l.isSameNode(d)){l=E,d=m;continue e}p=h(d);var C=d.nodeType,w=void 0;if(C===l.nodeType&&(C===N?(k?k!==p&&((g=S[k])?m===g?w=!1:(i.insertBefore(g,d),p?P(p):R(d,i,!0),d=g,p=h(d)):w=!1):p&&(w=!1),w=w!==!1&&D(d,l),w&&L(d,l)):(C===Z||C==ee)&&(w=!0,d.nodeValue!==l.nodeValue&&(d.nodeValue=l.nodeValue))),w){l=E,d=m;continue e}p?P(p):R(d,i,!0),d=m}if(k&&(g=S[k])&&D(g,l))o||K(i,g),L(g,l);else{var W=v(l);W!==!1&&(W&&(l=W),l.actualize&&(l=l.actualize(i.ownerDocument||u)),K(i,l),V(l))}l=E,d=m}ae(i,d,p);var j=Y[i.nodeName];j&&j(i,s)}var f=t,x=f.nodeType,q=n.nodeType;if(!z){if(x===N)q===N?D(t,n)||(M(t),f=ge(t,pe(n.nodeName,n.namespaceURI))):f=n;else if(x===Z||x===ee){if(q===x)return f.nodeValue!==n.nodeValue&&(f.nodeValue=n.nodeValue),f;f=n}}if(f===n)M(t);else{if(n.isSameNode&&n.isSameNode(f))return;if(L(f,n,z),O)for(var B=0,se=O.length;B<se;B++){var I=S[O[B]];I&&R(I,I.parentNode,!1)}}return!z&&f!==t&&t.parentNode&&(f.actualize&&(f=f.actualize(t.ownerDocument||u)),t.parentNode.replaceChild(f,t)),f}}var be=Ae(le),te=be;var U={silent:-1,error:3,warning:4,info:6,debug:7},G=class{constructor(e={}){this.worker=null,this.connected=!1,this.logLevel=U[e.logLevel]??U.silent}connect(e={}){if(this.connected)return;let t=e.wsPath||"/live",n=e.workerPath||"/assets/js/arizona-worker.min.js";this.worker=new Worker(n,{type:"module"});let a=window.location.protocol==="https:"?"wss:":"ws:",c=window.location.host,h=window.location.pathname,v=window.location.search,b=encodeURIComponent(h),T=v?encodeURIComponent(v.substring(1)):"",y=`${a}//${c}${t}?path=${b}&qs=${T}`;this.worker.postMessage({type:"connect",data:{url:y}}),this.worker.onmessage=H=>{this.handleWorkerMessage(H.data)}}sendEvent(e,t={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",event:e,params:t}})}sendEventTo(e,t,n={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",stateful_id:e,event:t,params:n}})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1}handleWorkerMessage(e){let{type:t,data:n}=e;try{switch(t){case"status":this.handleStatus(n);break;case"initial_render":break;case"html_patch":this.handleHtmlPatch(n);break;case"error":this.handleWorkerError(n);break;case"reload":this.handleReload(n);break;case"reply":this.handleReply(n);break;case"redirect":this.handleRedirect(n);break;default:this.handleUnknownMessage(e)}}catch(a){this.error("Error handling worker message:",a)}}handleStatus(e){e.status==="connected"?(this.connected=!0,this.info("Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,this.info("Disconnected from WebSocket")),this.dispatchArizonaEvent("status",e)}handleHtmlPatch(e){this.debug("Applying HTML patch"),this.applyHtmlPatch(e.patch)}applyHtmlPatch(e){let t=document.getElementById(e.statefulId);if(!t){this.warning(`Target element not found: ${e.statefulId}`);return}try{te(t,e.html,{onBeforeElUpdated(n,a){return!n.isEqualNode(a)}}),this.debug("Patch applied successfully"),t.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e}}))}catch(n){this.error("Error applying HTML patch:",n)}}handleWorkerError(e){this.error("Worker Error:",e.error),this.dispatchArizonaEvent("error",e)}handleReload(e){switch(e.file_type){case"css":this.info("CSS file changed. Refreshing stylesheets without page reload..."),document.querySelectorAll('link[rel="stylesheet"]').forEach(t=>{let n=t.href.split("?")[0];t.href=`${n}?t=${Date.now()}`});break;default:this.info(`${e.file_type||"File"} changed. Reloading page...`),window.location.reload()}}handleReply(e){this.debug("WebSocket reply:",e),this.dispatchArizonaEvent("reply",e)}handleRedirect(e){this.info("Redirecting to:",e.url),this.dispatchArizonaEvent("redirect",e),window.open(e.url,e.options?.target,e.options?.window_features)}handleUnknownMessage(e){this.warning("Unknown worker message:",e)}dispatchArizonaEvent(e,t){document.dispatchEvent(new CustomEvent("arizonaEvent",{detail:{type:e,data:t}}))}isConnected(){return this.connected}error(e,...t){console.error(`[Arizona] ${e}`,...t)}warning(e,...t){this.logLevel>=U.warning&&console.warn(`[Arizona] ${e}`,...t)}info(e,...t){this.logLevel>=U.info&&console.log(`[Arizona] ${e}`,...t)}debug(e,...t){this.logLevel>=U.debug&&console.log(`[Arizona] ${e}`,...t)}};export{G as default};
//# sourceMappingURL=arizona.min.js.map
