var J=11;function le(i,e){var t=e.attributes,r,a,c,o,p;if(!(e.nodeType===J||i.nodeType===J)){for(var S=t.length-1;S>=0;S--)r=t[S],a=r.name,c=r.namespaceURI,o=r.value,c?(a=r.localName||a,p=i.getAttributeNS(c,a),p!==o&&(r.prefix==="xmlns"&&(a=r.name),i.setAttributeNS(c,a,o))):(p=i.getAttribute(a),p!==o&&i.setAttribute(a,o));for(var T=i.attributes,k=T.length-1;k>=0;k--)r=T[k],a=r.name,c=r.namespaceURI,c?(a=r.localName||a,e.hasAttributeNS(c,a)||i.removeAttributeNS(c,a)):e.hasAttribute(a)||i.removeAttribute(a)}}var U,ue="http://www.w3.org/1999/xhtml",h=typeof document>"u"?void 0:document,oe=!!h&&"content"in h.createElement("template"),fe=!!h&&h.createRange&&"createContextualFragment"in h.createRange();function de(i){var e=h.createElement("template");return e.innerHTML=i,e.content.childNodes[0]}function he(i){U||(U=h.createRange(),U.selectNode(h.body));var e=U.createContextualFragment(i);return e.childNodes[0]}function pe(i){var e=h.createElement("body");return e.innerHTML=i,e.childNodes[0]}function ve(i){return i=i.trim(),oe?de(i):fe?he(i):pe(i)}function C(i,e){var t=i.nodeName,r=e.nodeName,a,c;return t===r?!0:(a=t.charCodeAt(0),c=r.charCodeAt(0),a<=90&&c>=97?t===r.toUpperCase():c<=90&&a>=97?r===t.toUpperCase():!1)}function ye(i,e){return!e||e===ue?h.createElement(i):h.createElementNS(e,i)}function ge(i,e){for(var t=i.firstChild;t;){var r=t.nextSibling;e.appendChild(t),t=r}return e}function B(i,e,t){i[t]!==e[t]&&(i[t]=e[t],i[t]?i.setAttribute(t,""):i.removeAttribute(t))}var q={OPTION:function(i,e){var t=i.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(i.hasAttribute("selected")&&!e.selected&&(i.setAttribute("selected","selected"),i.removeAttribute("selected")),t.selectedIndex=-1)}B(i,e,"selected")},INPUT:function(i,e){B(i,e,"checked"),B(i,e,"disabled"),i.value!==e.value&&(i.value=e.value),e.hasAttribute("value")||i.removeAttribute("value")},TEXTAREA:function(i,e){var t=e.value;i.value!==t&&(i.value=t);var r=i.firstChild;if(r){var a=r.nodeValue;if(a==t||!t&&a==i.placeholder)return;r.nodeValue=t}},SELECT:function(i,e){if(!e.hasAttribute("multiple")){for(var t=-1,r=0,a=i.firstChild,c,o;a;)if(o=a.nodeName&&a.nodeName.toUpperCase(),o==="OPTGROUP")c=a,a=c.firstChild;else{if(o==="OPTION"){if(a.hasAttribute("selected")){t=r;break}r++}a=a.nextSibling,!a&&c&&(a=c.nextSibling,c=null)}i.selectedIndex=t}}},M=1,Y=11,Q=3,Z=8;function A(){}function Ae(i){if(i)return i.getAttribute&&i.getAttribute("id")||i.id}function Se(i){return function(t,r,a){if(a||(a={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var c=r;r=h.createElement("html"),r.innerHTML=c}else r=ve(r);else r.nodeType===Y&&(r=r.firstElementChild);var o=a.getNodeKey||Ae,p=a.onBeforeNodeAdded||A,S=a.onNodeAdded||A,T=a.onBeforeElUpdated||A,k=a.onElUpdated||A,re=a.onBeforeNodeDiscarded||A,N=a.onNodeDiscarded||A,ae=a.onBeforeElChildrenUpdated||A,ie=a.skipFromChildren||A,F=a.addChild||function(n,s){return n.appendChild(s)},R=a.childrenOnly===!0,w=Object.create(null),L=[];function D(n){L.push(n)}function G(n,s){if(n.nodeType===M)for(var f=n.firstChild;f;){var l=void 0;s&&(l=o(f))?D(l):(N(f),f.firstChild&&G(f,s)),f=f.nextSibling}}function O(n,s,f){re(n)!==!1&&(s&&s.removeChild(n),N(n),G(n,f))}function _(n){if(n.nodeType===M||n.nodeType===Y)for(var s=n.firstChild;s;){var f=o(s);f&&(w[f]=s),_(s),s=s.nextSibling}}_(t);function V(n){S(n);for(var s=n.firstChild;s;){var f=s.nextSibling,l=o(s);if(l){var u=w[l];u&&C(s,u)?(s.parentNode.replaceChild(u,s),z(u,s)):V(s)}else V(s);s=f}}function ne(n,s,f){for(;s;){var l=s.nextSibling;(f=o(s))?D(f):O(s,n,!0),s=l}}function z(n,s,f){var l=o(s);if(l&&delete w[l],!f){var u=T(n,s);if(u===!1||(u instanceof HTMLElement&&(n=u,_(n)),i(n,s),k(n),ae(n,s)===!1))return}n.nodeName!=="TEXTAREA"?se(n,s):q.TEXTAREA(n,s)}function se(n,s){var f=ie(n,s),l=s.firstChild,u=n.firstChild,b,v,m,P,y;e:for(;l;){for(P=l.nextSibling,b=o(l);!f&&u;){if(m=u.nextSibling,l.isSameNode&&l.isSameNode(u)){l=P,u=m;continue e}v=o(u);var x=u.nodeType,g=void 0;if(x===l.nodeType&&(x===M?(b?b!==v&&((y=w[b])?m===y?g=!1:(n.insertBefore(y,u),v?D(v):O(u,n,!0),u=y,v=o(u)):g=!1):v&&(g=!1),g=g!==!1&&C(u,l),g&&z(u,l)):(x===Q||x==Z)&&(g=!0,u.nodeValue!==l.nodeValue&&(u.nodeValue=l.nodeValue))),g){l=P,u=m;continue e}v?D(v):O(u,n,!0),u=m}if(b&&(y=w[b])&&C(y,l))f||F(n,y),z(y,l);else{var W=p(l);W!==!1&&(W&&(l=W),l.actualize&&(l=l.actualize(n.ownerDocument||h)),F(n,l),V(l))}l=P,u=m}ne(n,u,v);var X=q[n.nodeName];X&&X(n,s)}var d=t,H=d.nodeType,K=r.nodeType;if(!R){if(H===M)K===M?C(t,r)||(N(t),d=ge(t,ye(r.nodeName,r.namespaceURI))):d=r;else if(H===Q||H===Z){if(K===H)return d.nodeValue!==r.nodeValue&&(d.nodeValue=r.nodeValue),d;d=r}}if(d===r)N(t);else{if(r.isSameNode&&r.isSameNode(d))return;if(z(d,r,R),L)for(var E=0,ce=L.length;E<ce;E++){var I=w[L[E]];I&&O(I,I.parentNode,!1)}}return!R&&d!==t&&t.parentNode&&(d.actualize&&(d=d.actualize(t.ownerDocument||h)),t.parentNode.replaceChild(d,t)),d}}var Te=Se(le),ee=Te;var j=class{constructor(){this.structure={}}initialize(e){this.structure=JSON.parse(JSON.stringify(e))}applyDiff(e,t){if(t?.type==="stateful"){this.structure[t.id]=t;return}this.structure[e]||console.warn(`[Arizona] StatefulId ${e} not found in structure`);for(let[r,a]of t)if(a&&typeof a=="object"&&a.type)this.structure[e].dynamic[r-1]=a;else if(Array.isArray(a)){let c=this.structure[e].dynamic[r-1];c&&c.type==="list"?this.structure[e].dynamic[r-1].dynamic=a:c&&c.type==="stateless"?a.forEach(([o,p])=>{this.structure[e].dynamic[r-1].dynamic[o-1]=p}):this.structure[e].dynamic[r-1]=a}else this.structure[e].dynamic[r-1]=a}generateStatefulHTML(e){let t=this.structure[e];return t||console.warn(`[Arizona] StatefulId ${e} not found in structure`),this.zipStaticDynamic(t.static,t.dynamic)}generateStatelessHTML(e){return this.zipStaticDynamic(e.static,e.dynamic)}generateListHTML(e){let{static:t,dynamic:r}=e;return r.reduce((a,c)=>a+this.zipStaticDynamic(t,c),"")}zipStaticDynamic(e,t){let r=[],a=Math.max(e.length,t.length);for(let c=0;c<a;c++)c<e.length&&r.push(e[c]),c<t.length&&r.push(this.normalizeDynamicElement(t[c]));return r.join("")}normalizeDynamicElement(e){return typeof e=="string"?e:e&&e.type==="stateful"?this.generateStatefulHTML(e.id):e&&e.type==="stateless"?this.generateStatelessHTML(e):e&&e.type==="list"?this.generateListHTML(e):Array.isArray(e)?this.flattenIoData(e):String(e)}flattenIoData(e){return typeof e=="string"?e:typeof e=="number"?String(e):Array.isArray(e)?e.map(t=>this.flattenIoData(t)).join(""):e&&typeof e=="object"?e.type==="stateful"?this.generateStatefulHTML(e.id):e.type==="stateless"?this.generateStatelessHTML(e):e.type==="list"?this.generateListHTML(e):String(e):String(e||"")}getStructure(){return JSON.parse(JSON.stringify(this.structure))}isInitialized(){return Object.keys(this.structure).length>0}getComponentIds(){return Object.keys(this.structure)}clear(){this.structure={}}createPatch(e){return{type:"html_patch",statefulId:e,html:this.generateStatefulHTML(e)}}createInitialPatch(e){return{type:"initial_render",statefulId:e,html:this.generateStatefulHTML(e)}}},te=j;var $=class{constructor(){this.worker=null,this.connected=!1,this.hierarchical=new te}connect(e={}){if(this.connected)return;let t=e.wsPath||"/live/websocket",r=e.workerPath||"/assets/js/arizona-worker.min.js";this.worker=new Worker(r,{type:"module"});let a=window.location.protocol==="https:"?"wss:":"ws:",c=window.location.host,o=window.location.pathname,p=encodeURIComponent(o),S=`${a}//${c}${t}?path=${p}`;this.worker.postMessage({type:"connect",data:{url:S}}),this.worker.onmessage=T=>{this.handleWorkerMessage(T.data)}}sendEvent(e,t={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",event:e,params:t}})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1,this.hierarchical.clear()}handleWorkerMessage(e){let{type:t,data:r}=e;try{switch(t){case"status":this.handleStatus(r);break;case"html_patch":this.handleHtmlPatch(r);break;case"error":this.handleWorkerError(r);break;case"message":this.handleWebSocketMessage(r);break;default:console.warn("[Arizona] Unknown worker message type:",t);break}}catch(a){console.error("[Arizona] Error handling worker message:",a)}}handleStatus(e){e.status==="connected"?(this.connected=!0,console.log("[Arizona] Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,console.log("[Arizona] Disconnected from WebSocket"))}handleHtmlPatch(e){let{patch:t,isInitial:r}=e;r?this.handleInitialRender(t):this.handleDiffPatch(t)}handleInitialRender(e){console.log("[Arizona] Applying initial render"),e.structure&&this.hierarchical.initialize(e.structure),this.applyHtmlPatch(e)}handleDiffPatch(e){console.log("[Arizona] Applying diff patch"),this.applyHtmlPatch(e)}applyHtmlPatch(e){let t=document.getElementById(e.statefulId);if(!t){console.warn(`[Arizona] Target element not found: ${e.statefulId}`);return}try{ee(t,e.html,{onBeforeElUpdated(r,a){return!r.isEqualNode(a)}}),console.log("[Arizona] Patch applied successfully"),t.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e}}))}catch(r){console.error("[Arizona] Error applying HTML patch:",r)}}handleWorkerError(e){console.error("[Arizona Worker Error]:",e.error)}handleWebSocketMessage(e){console.log("[Arizona] WebSocket message:",e)}isConnected(){return this.connected}};export{$ as default};
//# sourceMappingURL=arizona.min.js.map
