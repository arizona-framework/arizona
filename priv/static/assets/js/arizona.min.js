var X=11;function ce(a,e){var t=e.attributes,r,n,i,s,g;if(!(e.nodeType===X||a.nodeType===X)){for(var h=t.length-1;h>=0;h--)r=t[h],n=r.name,i=r.namespaceURI,s=r.value,i?(n=r.localName||n,g=a.getAttributeNS(i,n),g!==s&&(r.prefix==="xmlns"&&(n=r.name),a.setAttributeNS(i,n,s))):(g=a.getAttribute(n),g!==s&&a.setAttribute(n,s));for(var v=a.attributes,T=v.length-1;T>=0;T--)r=v[T],n=r.name,i=r.namespaceURI,i?(n=r.localName||n,e.hasAttributeNS(i,n)||a.removeAttributeNS(i,n)):e.hasAttribute(n)||a.removeAttribute(n)}}var L,le="http://www.w3.org/1999/xhtml",p=typeof document>"u"?void 0:document,ue=!!p&&"content"in p.createElement("template"),fe=!!p&&p.createRange&&"createContextualFragment"in p.createRange();function de(a){var e=p.createElement("template");return e.innerHTML=a,e.content.childNodes[0]}function he(a){L||(L=p.createRange(),L.selectNode(p.body));var e=L.createContextualFragment(a);return e.childNodes[0]}function pe(a){var e=p.createElement("body");return e.innerHTML=a,e.childNodes[0]}function ve(a){return a=a.trim(),ue?de(a):fe?he(a):pe(a)}function U(a,e){var t=a.nodeName,r=e.nodeName,n,i;return t===r?!0:(n=t.charCodeAt(0),i=r.charCodeAt(0),n<=90&&i>=97?t===r.toUpperCase():i<=90&&n>=97?r===t.toUpperCase():!1)}function ge(a,e){return!e||e===le?p.createElement(a):p.createElementNS(e,a)}function me(a,e){for(var t=a.firstChild;t;){var r=t.nextSibling;e.appendChild(t),t=r}return e}function B(a,e,t){a[t]!==e[t]&&(a[t]=e[t],a[t]?a.setAttribute(t,""):a.removeAttribute(t))}var q={OPTION:function(a,e){var t=a.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(a.hasAttribute("selected")&&!e.selected&&(a.setAttribute("selected","selected"),a.removeAttribute("selected")),t.selectedIndex=-1)}B(a,e,"selected")},INPUT:function(a,e){B(a,e,"checked"),B(a,e,"disabled"),a.value!==e.value&&(a.value=e.value),e.hasAttribute("value")||a.removeAttribute("value")},TEXTAREA:function(a,e){var t=e.value;a.value!==t&&(a.value=t);var r=a.firstChild;if(r){var n=r.nodeValue;if(n==t||!t&&n==a.placeholder)return;r.nodeValue=t}},SELECT:function(a,e){if(!e.hasAttribute("multiple")){for(var t=-1,r=0,n=a.firstChild,i,s;n;)if(s=n.nodeName&&n.nodeName.toUpperCase(),s==="OPTGROUP")i=n,n=i.firstChild;else{if(s==="OPTION"){if(n.hasAttribute("selected")){t=r;break}r++}n=n.nextSibling,!n&&i&&(n=i.nextSibling,i=null)}a.selectedIndex=t}}},O=1,Y=11,Q=3,Z=8;function A(){}function ye(a){if(a)return a.getAttribute&&a.getAttribute("id")||a.id}function Se(a){return function(t,r,n){if(n||(n={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var i=r;r=p.createElement("html"),r.innerHTML=i}else r=ve(r);else r.nodeType===Y&&(r=r.firstElementChild);var s=n.getNodeKey||ye,g=n.onBeforeNodeAdded||A,h=n.onNodeAdded||A,v=n.onBeforeElUpdated||A,T=n.onElUpdated||A,re=n.onBeforeNodeDiscarded||A,N=n.onNodeDiscarded||A,ne=n.onBeforeElChildrenUpdated||A,ae=n.skipFromChildren||A,$=n.addChild||function(o,c){return o.appendChild(c)},D=n.childrenOnly===!0,w=Object.create(null),x=[];function I(o){x.push(o)}function G(o,c){if(o.nodeType===O)for(var f=o.firstChild;f;){var l=void 0;c&&(l=s(f))?I(l):(N(f),f.firstChild&&G(f,c)),f=f.nextSibling}}function M(o,c,f){re(o)!==!1&&(c&&c.removeChild(o),N(o),G(o,f))}function j(o){if(o.nodeType===O||o.nodeType===Y)for(var c=o.firstChild;c;){var f=s(c);f&&(w[f]=c),j(c),c=c.nextSibling}}j(t);function R(o){h(o);for(var c=o.firstChild;c;){var f=c.nextSibling,l=s(c);if(l){var u=w[l];u&&U(c,u)?(c.parentNode.replaceChild(u,c),C(u,c)):R(c)}else R(c);c=f}}function ie(o,c,f){for(;c;){var l=c.nextSibling;(f=s(c))?I(f):M(c,o,!0),c=l}}function C(o,c,f){var l=s(c);if(l&&delete w[l],!f){var u=v(o,c);if(u===!1||(u instanceof HTMLElement&&(o=u,j(o)),a(o,c),T(o),ne(o,c)===!1))return}o.nodeName!=="TEXTAREA"?se(o,c):q.TEXTAREA(o,c)}function se(o,c){var f=ae(o,c),l=c.firstChild,u=o.firstChild,b,m,k,H,y;e:for(;l;){for(H=l.nextSibling,b=s(l);!f&&u;){if(k=u.nextSibling,l.isSameNode&&l.isSameNode(u)){l=H,u=k;continue e}m=s(u);var z=u.nodeType,S=void 0;if(z===l.nodeType&&(z===O?(b?b!==m&&((y=w[b])?k===y?S=!1:(o.insertBefore(y,u),m?I(m):M(u,o,!0),u=y,m=s(u)):S=!1):m&&(S=!1),S=S!==!1&&U(u,l),S&&C(u,l)):(z===Q||z==Z)&&(S=!0,u.nodeValue!==l.nodeValue&&(u.nodeValue=l.nodeValue))),S){l=H,u=k;continue e}m?I(m):M(u,o,!0),u=k}if(b&&(y=w[b])&&U(y,l))f||$(o,y),C(y,l);else{var W=g(l);W!==!1&&(W&&(l=W),l.actualize&&(l=l.actualize(o.ownerDocument||p)),$(o,l),R(l))}l=H,u=k}ie(o,u,m);var K=q[o.nodeName];K&&K(o,c)}var d=t,P=d.nodeType,J=r.nodeType;if(!D){if(P===O)J===O?U(t,r)||(N(t),d=me(t,ge(r.nodeName,r.namespaceURI))):d=r;else if(P===Q||P===Z){if(J===P)return d.nodeValue!==r.nodeValue&&(d.nodeValue=r.nodeValue),d;d=r}}if(d===r)N(t);else{if(r.isSameNode&&r.isSameNode(d))return;if(C(d,r,D),x)for(var _=0,oe=x.length;_<oe;_++){var V=w[x[_]];V&&M(V,V.parentNode,!1)}}return!D&&d!==t&&t.parentNode&&(d.actualize&&(d=d.actualize(t.ownerDocument||p)),t.parentNode.replaceChild(d,t)),d}}var Ae=Se(ce),ee=Ae;var E=class{constructor(){this.structure={}}initialize(e){this.structure=JSON.parse(JSON.stringify(e))}applyDiff(e){for(let[t,r]of e){if(!this.structure[t]){console.warn(`[Arizona] StatefulId ${t} not found in structure`);continue}for(let[n,i]of r)this.structure[t][n]=i}}generateHTML(e="root"){let t=this.structure[e];if(!t)return"";let r=[],n=Object.keys(t).map(i=>parseInt(i)).sort((i,s)=>i-s);for(let i of n){let s=t[i];typeof s=="string"?r.push(s):s&&s.type==="stateful"?r.push(this.generateHTML(s.id)):s&&s.type==="stateless"?r.push(this.generateHTMLFromStructure(s.structure)):s&&s.type==="list"?r.push(this.generateListHTML(s)):r.push(String(s))}return r.join("")}generateHTMLFromStructure(e){let t=[],r=Object.keys(e).map(n=>parseInt(n)).sort((n,i)=>n-i);for(let n of r){let i=e[n];typeof i=="string"?t.push(i):t.push(String(i))}return t.join("")}generateListHTML(e){let{static:t,dynamic:r}=e,n=[];for(let i of r){let s=[],g=Object.keys(i).map(v=>parseInt(v)).sort((v,T)=>v-T),h=0;for(let v of g)h<t.length&&(s.push(t[h]),h++),s.push(String(i[v]));for(;h<t.length;)s.push(t[h]),h++;n.push(s.join(""))}return n.join("")}getStructure(){return JSON.parse(JSON.stringify(this.structure))}isInitialized(){return Object.keys(this.structure).length>0}getComponent(e){return this.structure[e]||null}hasComponent(e){return e in this.structure}getComponentIds(){return Object.keys(this.structure)}clear(){this.structure={}}createPatch(e="[data-arizona-root]",t="root"){return{type:"html_patch",selector:e,html:this.generateHTML(t),timestamp:Date.now()}}createInitialPatch(e="[data-arizona-root]",t="root"){return{type:"initial_render",selector:e,html:this.generateHTML(t),structure:this.getStructure(),timestamp:Date.now()}}static validateStructure(e){if(!e||typeof e!="object")return!1;for(let[t,r]of Object.entries(e)){if(!r||typeof r!="object")return!1;let n=Object.keys(r);for(let i of n)if(isNaN(parseInt(i)))return!1}return!0}static validateDiff(e){if(!Array.isArray(e))return!1;for(let t of e){if(!Array.isArray(t)||t.length!==2)return!1;let[r,n]=t;if(typeof r!="string"||!Array.isArray(n))return!1;for(let i of n){if(!Array.isArray(i)||i.length!==2)return!1;let[s]=i;if(isNaN(parseInt(s)))return!1}}return!0}};var te=E;var F=class{constructor(){this.worker=null,this.connected=!1,this.hierarchical=new te,this.targetSelector="[data-arizona-root]"}connect(e={}){if(this.connected)return;let t=e.wsPath||"/live/websocket",r=e.workerPath||"/assets/js/arizona-worker.min.js";this.worker=new Worker(r,{type:"module"});let n=window.location.protocol==="https:"?"wss:":"ws:",i=window.location.host,s=window.location.pathname,g=encodeURIComponent(s),h=`${n}//${i}${t}?path=${g}`;this.worker.postMessage({type:"connect",data:{url:h}}),this.worker.onmessage=v=>{this.handleWorkerMessage(v.data)}}sendEvent(e,t={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",event:e,params:t}})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1,this.hierarchical.clear()}handleWorkerMessage(e){let{type:t,data:r}=e;try{switch(t){case"status":this.handleStatus(r);break;case"html_patch":this.handleHtmlPatch(r);break;case"error":this.handleWorkerError(r);break;case"message":this.handleWebSocketMessage(r);break;default:console.warn("[Arizona] Unknown worker message type:",t);break}}catch(n){console.error("[Arizona] Error handling worker message:",n)}}handleStatus(e){e.status==="connected"?(this.connected=!0,console.log("[Arizona] Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,console.log("[Arizona] Disconnected from WebSocket"))}handleHtmlPatch(e){let{patch:t,isInitial:r}=e;r?this.handleInitialRender(t):this.handleDiffPatch(t)}handleInitialRender(e){console.log("[Arizona] Applying initial render"),e.structure&&this.hierarchical.initialize(e.structure),this.applyHtmlPatch(e)}handleDiffPatch(e){console.log("[Arizona] Applying diff patch"),this.applyHtmlPatch(e)}applyHtmlPatch(e){let t=document.querySelector(e.selector||this.targetSelector);if(!t){console.warn(`[Arizona] Target element not found: ${e.selector||this.targetSelector}`);return}try{ee(t,e.html,{childrenOnly:!0,onBeforeElUpdated(r,n){return!r.isEqualNode(n)}}),console.log("[Arizona] Patch applied successfully"),t.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e,timestamp:e.timestamp}}))}catch(r){console.error("[Arizona] Error applying HTML patch:",r)}}handleWorkerError(e){console.error("[Arizona Worker Error]:",e.error)}handleWebSocketMessage(e){console.log("[Arizona] WebSocket message:",e)}getHierarchicalStructure(){return this.hierarchical.getStructure()}isConnected(){return this.connected}setTargetSelector(e){this.targetSelector=e}};export{F as default};
//# sourceMappingURL=arizona.min.js.map
