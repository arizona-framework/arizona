var q=11;function le(n,e){var r=e.attributes,t,a,c,u,p;if(!(e.nodeType===q||n.nodeType===q)){for(var A=r.length-1;A>=0;A--)t=r[A],a=t.name,c=t.namespaceURI,u=t.value,c?(a=t.localName||a,p=n.getAttributeNS(c,a),p!==u&&(t.prefix==="xmlns"&&(a=t.name),n.setAttributeNS(c,a,u))):(p=n.getAttribute(a),p!==u&&n.setAttribute(a,u));for(var T=n.attributes,w=T.length-1;w>=0;w--)t=T[w],a=t.name,c=t.namespaceURI,c?(a=t.localName||a,e.hasAttributeNS(c,a)||n.removeAttributeNS(c,a)):e.hasAttribute(a)||n.removeAttribute(a)}}var U,oe="http://www.w3.org/1999/xhtml",h=typeof document>"u"?void 0:document,ue=!!h&&"content"in h.createElement("template"),de=!!h&&h.createRange&&"createContextualFragment"in h.createRange();function fe(n){var e=h.createElement("template");return e.innerHTML=n,e.content.childNodes[0]}function he(n){U||(U=h.createRange(),U.selectNode(h.body));var e=U.createContextualFragment(n);return e.childNodes[0]}function pe(n){var e=h.createElement("body");return e.innerHTML=n,e.childNodes[0]}function ve(n){return n=n.trim(),ue?fe(n):de?he(n):pe(n)}function C(n,e){var r=n.nodeName,t=e.nodeName,a,c;return r===t?!0:(a=r.charCodeAt(0),c=t.charCodeAt(0),a<=90&&c>=97?r===t.toUpperCase():c<=90&&a>=97?t===r.toUpperCase():!1)}function ge(n,e){return!e||e===oe?h.createElement(n):h.createElementNS(e,n)}function ye(n,e){for(var r=n.firstChild;r;){var t=r.nextSibling;e.appendChild(r),r=t}return e}function $(n,e,r){n[r]!==e[r]&&(n[r]=e[r],n[r]?n.setAttribute(r,""):n.removeAttribute(r))}var Q={OPTION:function(n,e){var r=n.parentNode;if(r){var t=r.nodeName.toUpperCase();t==="OPTGROUP"&&(r=r.parentNode,t=r&&r.nodeName.toUpperCase()),t==="SELECT"&&!r.hasAttribute("multiple")&&(n.hasAttribute("selected")&&!e.selected&&(n.setAttribute("selected","selected"),n.removeAttribute("selected")),r.selectedIndex=-1)}$(n,e,"selected")},INPUT:function(n,e){$(n,e,"checked"),$(n,e,"disabled"),n.value!==e.value&&(n.value=e.value),e.hasAttribute("value")||n.removeAttribute("value")},TEXTAREA:function(n,e){var r=e.value;n.value!==r&&(n.value=r);var t=n.firstChild;if(t){var a=t.nodeValue;if(a==r||!r&&a==n.placeholder)return;t.nodeValue=r}},SELECT:function(n,e){if(!e.hasAttribute("multiple")){for(var r=-1,t=0,a=n.firstChild,c,u;a;)if(u=a.nodeName&&a.nodeName.toUpperCase(),u==="OPTGROUP")c=a,a=c.firstChild,a||(a=c.nextSibling,c=null);else{if(u==="OPTION"){if(a.hasAttribute("selected")){r=t;break}t++}a=a.nextSibling,!a&&c&&(a=c.nextSibling,c=null)}n.selectedIndex=r}}},M=1,Y=11,Z=3,ee=8;function S(){}function Se(n){if(n)return n.getAttribute&&n.getAttribute("id")||n.id}function Ae(n){return function(r,t,a){if(a||(a={}),typeof t=="string")if(r.nodeName==="#document"||r.nodeName==="HTML"||r.nodeName==="BODY"){var c=t;t=h.createElement("html"),t.innerHTML=c}else t=ve(t);else t.nodeType===Y&&(t=t.firstElementChild);var u=a.getNodeKey||Se,p=a.onBeforeNodeAdded||S,A=a.onNodeAdded||S,T=a.onBeforeElUpdated||S,w=a.onElUpdated||S,R=a.onBeforeNodeDiscarded||S,z=a.onNodeDiscarded||S,ae=a.onBeforeElChildrenUpdated||S,ne=a.skipFromChildren||S,G=a.addChild||function(i,s){return i.appendChild(s)},_=a.childrenOnly===!0,b=Object.create(null),N=[];function L(i){N.push(i)}function K(i,s){if(i.nodeType===M)for(var d=i.firstChild;d;){var l=void 0;s&&(l=u(d))?L(l):(z(d),d.firstChild&&K(d,s)),d=d.nextSibling}}function D(i,s,d){R(i)!==!1&&(s&&s.removeChild(i),z(i),K(i,d))}function I(i){if(i.nodeType===M||i.nodeType===Y)for(var s=i.firstChild;s;){var d=u(s);d&&(b[d]=s),I(s),s=s.nextSibling}}I(r);function E(i){A(i);for(var s=i.firstChild;s;){var d=s.nextSibling,l=u(s);if(l){var o=b[l];o&&C(s,o)?(s.parentNode.replaceChild(o,s),O(o,s)):E(s)}else E(s);s=d}}function ie(i,s,d){for(;s;){var l=s.nextSibling;(d=u(s))?L(d):D(s,i,!0),s=l}}function O(i,s,d){var l=u(s);if(l&&delete b[l],!d){var o=T(i,s);if(o===!1||(o instanceof HTMLElement&&(i=o,I(i)),n(i,s),w(i),ae(i,s)===!1))return}i.nodeName!=="TEXTAREA"?se(i,s):Q.TEXTAREA(i,s)}function se(i,s){var d=ne(i,s),l=s.firstChild,o=i.firstChild,m,v,k,x,g;e:for(;l;){for(x=l.nextSibling,m=u(l);!d&&o;){if(k=o.nextSibling,l.isSameNode&&l.isSameNode(o)){l=x,o=k;continue e}v=u(o);var P=o.nodeType,y=void 0;if(P===l.nodeType&&(P===M?(m?m!==v&&((g=b[m])?k===g?y=!1:(i.insertBefore(g,o),v?L(v):D(o,i,!0),o=g,v=u(o)):y=!1):v&&(y=!1),y=y!==!1&&C(o,l),y&&O(o,l)):(P===Z||P==ee)&&(y=!0,o.nodeValue!==l.nodeValue&&(o.nodeValue=l.nodeValue))),y){l=x,o=k;continue e}v?L(v):D(o,i,!0),o=k}if(m&&(g=b[m])&&C(g,l))d||G(i,g),O(g,l);else{var B=p(l);B!==!1&&(B&&(l=B),l.actualize&&(l=l.actualize(i.ownerDocument||h)),G(i,l),E(l))}l=x,o=k}ie(i,o,v);var J=Q[i.nodeName];J&&J(i,s)}var f=r,H=f.nodeType,X=t.nodeType;if(!_){if(H===M)X===M?C(r,t)||(z(r),f=ye(r,ge(t.nodeName,t.namespaceURI))):f=t;else if(H===Z||H===ee){if(X===H)return f.nodeValue!==t.nodeValue&&(f.nodeValue=t.nodeValue),f;f=t}}if(f===t)z(r);else{if(t.isSameNode&&t.isSameNode(f))return;if(O(f,t,_),N)for(var V=0,ce=N.length;V<ce;V++){var W=b[N[V]];W&&D(W,W.parentNode,!1)}}return!_&&f!==r&&r.parentNode&&(f.actualize&&(f=f.actualize(r.ownerDocument||h)),r.parentNode.replaceChild(f,r)),f}}var we=Ae(le),te=we;var j=class{constructor(){this.structure=new Map}initialize(e){this.structure=new Map(Object.entries(JSON.parse(JSON.stringify(e))))}applyDiff(e,r){if(r?.type==="stateful"){this.structure.set(r.id,r);return}if(!this.structure.has(e)){let t=String(e).replace(/\r|\n/g,"");console.warn(`[Arizona] StatefulId '${t}' not found in structure`)}for(let[t,a]of r)if(a&&typeof a=="object"&&a.type)this.structure.get(e).dynamic[t-1]=a;else if(Array.isArray(a)){let c=this.structure.get(e).dynamic[t-1];c&&c.type==="list"?this.structure.get(e).dynamic[t-1].dynamic=a:c&&c.type==="stateless"?a.forEach(([u,p])=>{this.structure.get(e).dynamic[t-1].dynamic[u-1]=p}):this.structure.get(e).dynamic[t-1]=a}else this.structure.get(e).dynamic[t-1]=a}generateStatefulHTML(e){let r=this.structure.get(e);if(!r){let t=String(e).replace(/\r|\n/g,"");console.warn(`[Arizona] StatefulId '${t}' not found in structure`)}return this.zipStaticDynamic(r.static,r.dynamic)}generateStatelessHTML(e){return this.zipStaticDynamic(e.static,e.dynamic)}generateListHTML(e){let{static:r,dynamic:t}=e;return t.reduce((a,c)=>a+this.zipStaticDynamic(r,c),"")}zipStaticDynamic(e,r){let t=[],a=Math.max(e.length,r.length);for(let c=0;c<a;c++)c<e.length&&t.push(e[c]),c<r.length&&t.push(this.normalizeDynamicElement(r[c]));return t.join("")}normalizeDynamicElement(e){return typeof e=="string"?e:e&&e.type==="stateful"?this.generateStatefulHTML(e.id):e&&e.type==="stateless"?this.generateStatelessHTML(e):e&&e.type==="list"?this.generateListHTML(e):Array.isArray(e)?this.flattenIoData(e):String(e)}flattenIoData(e){return typeof e=="string"?e:typeof e=="number"?String(e):Array.isArray(e)?e.map(r=>this.flattenIoData(r)).join(""):e&&typeof e=="object"?e.type==="stateful"?this.generateStatefulHTML(e.id):e.type==="stateless"?this.generateStatelessHTML(e):e.type==="list"?this.generateListHTML(e):String(e):String(e||"")}getStructure(){return JSON.parse(JSON.stringify(Object.fromEntries(this.structure)))}isInitialized(){return this.structure.size>0}getComponentIds(){return Array.from(this.structure.keys())}clear(){this.structure=new Map}createPatch(e){return{type:"html_patch",statefulId:e,html:this.generateStatefulHTML(e)}}createInitialPatch(e){return{type:"initial_render",statefulId:e,html:this.generateStatefulHTML(e)}}},re=j;var F=class{constructor(){this.worker=null,this.connected=!1,this.hierarchical=new re}connect(e={}){if(this.connected)return;let r=e.wsPath||"/live/websocket",t=e.workerPath||"/assets/js/arizona-worker.min.js";this.worker=new Worker(t,{type:"module"});let a=window.location.protocol==="https:"?"wss:":"ws:",c=window.location.host,u=window.location.pathname,p=window.location.search,A=encodeURIComponent(u),T=p?encodeURIComponent(p.substring(1)):"",w=`${a}//${c}${r}?path=${A}&qs=${T}`;this.worker.postMessage({type:"connect",data:{url:w}}),this.worker.onmessage=R=>{this.handleWorkerMessage(R.data)}}sendEvent(e,r={},t){if(!this.connected)return;let a={type:"event",event:e,params:r};t!==void 0&&(a.stateful_id=t),this.worker.postMessage({type:"send",data:a})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1,this.hierarchical.clear()}handleWorkerMessage(e){let{type:r,data:t}=e;try{switch(r){case"status":this.handleStatus(t);break;case"html_patch":this.handleHtmlPatch(t);break;case"error":this.handleWorkerError(t);break;case"reload":this.handleReload(t);break;case"message":this.handleWebSocketMessage(t);break;default:console.warn("[Arizona] Unknown worker message type:",r);break}}catch(a){console.error("[Arizona] Error handling worker message:",a)}}handleStatus(e){e.status==="connected"?(this.connected=!0,console.log("[Arizona] Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,console.log("[Arizona] Disconnected from WebSocket"))}handleHtmlPatch(e){let{patch:r,isInitial:t}=e;t?this.handleInitialRender(r):this.handleDiffPatch(r)}handleInitialRender(e){console.log("[Arizona] Applying initial render"),e.structure&&this.hierarchical.initialize(e.structure),this.applyHtmlPatch(e)}handleDiffPatch(e){console.log("[Arizona] Applying diff patch"),this.applyHtmlPatch(e)}applyHtmlPatch(e){let r=document.getElementById(e.statefulId);if(!r){console.warn(`[Arizona] Target element not found: ${e.statefulId}`);return}try{te(r,e.html,{onBeforeElUpdated(t,a){return!t.isEqualNode(a)}}),console.log("[Arizona] Patch applied successfully"),r.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e}}))}catch(t){console.error("[Arizona] Error applying HTML patch:",t)}}handleWorkerError(e){console.error("[Arizona Worker Error]:",e.error)}handleWebSocketMessage(e){console.log("[Arizona] WebSocket message:",e)}handleReload(e){console.log(`[Arizona] File changed: ${e.file}, reloading page...`),window.location.reload()}isConnected(){return this.connected}};export{F as default};
//# sourceMappingURL=arizona.min.js.map
