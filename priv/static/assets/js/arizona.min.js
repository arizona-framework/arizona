var J=11;function oe(n,e){var t=e.attributes,r,i,l,u,p;if(!(e.nodeType===J||n.nodeType===J)){for(var S=t.length-1;S>=0;S--)r=t[S],i=r.name,l=r.namespaceURI,u=r.value,l?(i=r.localName||i,p=n.getAttributeNS(l,i),p!==u&&(r.prefix==="xmlns"&&(i=r.name),n.setAttributeNS(l,i,u))):(p=n.getAttribute(i),p!==u&&n.setAttribute(i,u));for(var T=n.attributes,A=T.length-1;A>=0;A--)r=T[A],i=r.name,l=r.namespaceURI,l?(i=r.localName||i,e.hasAttributeNS(l,i)||n.removeAttributeNS(l,i)):e.hasAttribute(i)||n.removeAttribute(i)}}var E,ue="http://www.w3.org/1999/xhtml",f=typeof document>"u"?void 0:document,de=!!f&&"content"in f.createElement("template"),he=!!f&&f.createRange&&"createContextualFragment"in f.createRange();function fe(n){var e=f.createElement("template");return e.innerHTML=n,e.content.childNodes[0]}function pe(n){E||(E=f.createRange(),E.selectNode(f.body));var e=E.createContextualFragment(n);return e.childNodes[0]}function ve(n){var e=f.createElement("body");return e.innerHTML=n,e.childNodes[0]}function ge(n){return n=n.trim(),de?fe(n):he?pe(n):ve(n)}function P(n,e){var t=n.nodeName,r=e.nodeName,i,l;return t===r?!0:(i=t.charCodeAt(0),l=r.charCodeAt(0),i<=90&&l>=97?t===r.toUpperCase():l<=90&&i>=97?r===t.toUpperCase():!1)}function ye(n,e){return!e||e===ue?f.createElement(n):f.createElementNS(e,n)}function we(n,e){for(var t=n.firstChild;t;){var r=t.nextSibling;e.appendChild(t),t=r}return e}function W(n,e,t){n[t]!==e[t]&&(n[t]=e[t],n[t]?n.setAttribute(t,""):n.removeAttribute(t))}var Q={OPTION:function(n,e){var t=n.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(n.hasAttribute("selected")&&!e.selected&&(n.setAttribute("selected","selected"),n.removeAttribute("selected")),t.selectedIndex=-1)}W(n,e,"selected")},INPUT:function(n,e){W(n,e,"checked"),W(n,e,"disabled"),n.value!==e.value&&(n.value=e.value),e.hasAttribute("value")||n.removeAttribute("value")},TEXTAREA:function(n,e){var t=e.value;n.value!==t&&(n.value=t);var r=n.firstChild;if(r){var i=r.nodeValue;if(i==t||!t&&i==n.placeholder)return;r.nodeValue=t}},SELECT:function(n,e){if(!e.hasAttribute("multiple")){for(var t=-1,r=0,i=n.firstChild,l,u;i;)if(u=i.nodeName&&i.nodeName.toUpperCase(),u==="OPTGROUP")l=i,i=l.firstChild,i||(i=l.nextSibling,l=null);else{if(u==="OPTION"){if(i.hasAttribute("selected")){t=r;break}r++}i=i.nextSibling,!i&&l&&(i=l.nextSibling,l=null)}n.selectedIndex=t}}},M=1,Y=11,Z=3,ee=8;function w(){}function Se(n){if(n)return n.getAttribute&&n.getAttribute("id")||n.id}function Ae(n){return function(t,r,i){if(i||(i={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var l=r;r=f.createElement("html"),r.innerHTML=l}else r=ge(r);else r.nodeType===Y&&(r=r.firstElementChild);var u=i.getNodeKey||Se,p=i.onBeforeNodeAdded||w,S=i.onNodeAdded||w,T=i.onBeforeElUpdated||w,A=i.onElUpdated||w,ie=i.onBeforeNodeDiscarded||w,N=i.onNodeDiscarded||w,ne=i.onBeforeElChildrenUpdated||w,ae=i.skipFromChildren||w,G=i.addChild||function(a,s){return a.appendChild(s)},C=i.childrenOnly===!0,b=Object.create(null),z=[];function D(a){z.push(a)}function K(a,s){if(a.nodeType===M)for(var d=a.firstChild;d;){var c=void 0;s&&(c=u(d))?D(c):(N(d),d.firstChild&&K(d,s)),d=d.nextSibling}}function O(a,s,d){ie(a)!==!1&&(s&&s.removeChild(a),N(a),K(a,d))}function _(a){if(a.nodeType===M||a.nodeType===Y)for(var s=a.firstChild;s;){var d=u(s);d&&(b[d]=s),_(s),s=s.nextSibling}}_(t);function $(a){S(a);for(var s=a.firstChild;s;){var d=s.nextSibling,c=u(s);if(c){var o=b[c];o&&P(s,o)?(s.parentNode.replaceChild(o,s),H(o,s)):$(s)}else $(s);s=d}}function se(a,s,d){for(;s;){var c=s.nextSibling;(d=u(s))?D(d):O(s,a,!0),s=c}}function H(a,s,d){var c=u(s);if(c&&delete b[c],!d){var o=T(a,s);if(o===!1||(o instanceof HTMLElement&&(a=o,_(a)),n(a,s),A(a),ne(a,s)===!1))return}a.nodeName!=="TEXTAREA"?le(a,s):Q.TEXTAREA(a,s)}function le(a,s){var d=ae(a,s),c=s.firstChild,o=a.firstChild,m,v,L,R,g;e:for(;c;){for(R=c.nextSibling,m=u(c);!d&&o;){if(L=o.nextSibling,c.isSameNode&&c.isSameNode(o)){c=R,o=L;continue e}v=u(o);var U=o.nodeType,y=void 0;if(U===c.nodeType&&(U===M?(m?m!==v&&((g=b[m])?L===g?y=!1:(a.insertBefore(g,o),v?D(v):O(o,a,!0),o=g,v=u(o)):y=!1):v&&(y=!1),y=y!==!1&&P(o,c),y&&H(o,c)):(U===Z||U==ee)&&(y=!0,o.nodeValue!==c.nodeValue&&(o.nodeValue=c.nodeValue))),y){c=R,o=L;continue e}v?D(v):O(o,a,!0),o=L}if(m&&(g=b[m])&&P(g,c))d||G(a,g),H(g,c);else{var B=p(c);B!==!1&&(B&&(c=B),c.actualize&&(c=c.actualize(a.ownerDocument||f)),G(a,c),$(c))}c=R,o=L}se(a,o,v);var q=Q[a.nodeName];q&&q(a,s)}var h=t,x=h.nodeType,X=r.nodeType;if(!C){if(x===M)X===M?P(t,r)||(N(t),h=we(t,ye(r.nodeName,r.namespaceURI))):h=r;else if(x===Z||x===ee){if(X===x)return h.nodeValue!==r.nodeValue&&(h.nodeValue=r.nodeValue),h;h=r}}if(h===r)N(t);else{if(r.isSameNode&&r.isSameNode(h))return;if(H(h,r,C),z)for(var I=0,ce=z.length;I<ce;I++){var V=b[z[I]];V&&O(V,V.parentNode,!1)}}return!C&&h!==t&&t.parentNode&&(h.actualize&&(h=h.actualize(t.ownerDocument||f)),t.parentNode.replaceChild(h,t)),h}}var Te=Ae(oe),te=Te;var j=class{constructor(){this.structure=new Map}initialize(e){this.structure=new Map(Object.entries(JSON.parse(JSON.stringify(e))))}applyDiff(e,t){if(t?.type==="stateful"){this.structure.set(t.id,t);return}if(!this.structure.has(e)){let r=String(e).replace(/\r|\n/g,"");console.warn(`[Arizona] StatefulId '${r}' not found in structure`)}for(let[r,i]of t)if(i&&typeof i=="object"&&i.type)this.structure.get(e).dynamic[r-1]=i;else if(Array.isArray(i)){let l=this.structure.get(e).dynamic[r-1];l&&l.type==="list"?this.structure.get(e).dynamic[r-1].dynamic=i:l&&l.type==="stateless"?i.forEach(([u,p])=>{this.structure.get(e).dynamic[r-1].dynamic[u-1]=p}):this.structure.get(e).dynamic[r-1]=i}else this.structure.get(e).dynamic[r-1]=i}generateStatefulHTML(e){let t=this.structure.get(e);if(!t){let r=String(e).replace(/\r|\n/g,"");console.warn(`[Arizona] StatefulId '${r}' not found in structure`)}return this.zipStaticDynamic(t.static,t.dynamic)}generateStatelessHTML(e){return this.zipStaticDynamic(e.static,e.dynamic)}generateListHTML(e){let{static:t,dynamic:r}=e;return r.reduce((i,l)=>i+this.zipStaticDynamic(t,l),"")}zipStaticDynamic(e,t){let r=[],i=Math.max(e.length,t.length);for(let l=0;l<i;l++)l<e.length&&r.push(e[l]),l<t.length&&r.push(this.normalizeDynamicElement(t[l]));return r.join("")}normalizeDynamicElement(e){return typeof e=="string"?e:e&&e.type==="stateful"?this.generateStatefulHTML(e.id):e&&e.type==="stateless"?this.generateStatelessHTML(e):e&&e.type==="list"?this.generateListHTML(e):Array.isArray(e)?this.flattenIoData(e):String(e)}flattenIoData(e){return typeof e=="string"?e:typeof e=="number"?String(e):Array.isArray(e)?e.map(t=>this.flattenIoData(t)).join(""):e&&typeof e=="object"?e.type==="stateful"?this.generateStatefulHTML(e.id):e.type==="stateless"?this.generateStatelessHTML(e):e.type==="list"?this.generateListHTML(e):String(e):String(e||"")}getStructure(){return JSON.parse(JSON.stringify(Object.fromEntries(this.structure)))}isInitialized(){return this.structure.size>0}getComponentIds(){return Array.from(this.structure.keys())}clear(){this.structure=new Map}createPatch(e){return{type:"html_patch",statefulId:e,html:this.generateStatefulHTML(e)}}createInitialPatch(e){return{type:"initial_render",statefulId:e,html:this.generateStatefulHTML(e)}}},re=j;var k={silent:-1,error:3,warning:4,info:6,debug:7},F=class{constructor(e={}){this.worker=null,this.connected=!1,this.hierarchical=new re,this.logLevel=k[e.logLevel]??k.silent}connect(e={}){if(this.connected)return;let t=e.wsPath||"/live";this.worker=new Worker(new URL("./arizona-worker.min.js",import.meta.url),{type:"module"});let r=window.location.protocol==="https:"?"wss:":"ws:",i=window.location.host,l=window.location.pathname,u=window.location.search,p=encodeURIComponent(l),S=u?encodeURIComponent(u.substring(1)):"",T=`${r}//${i}${t}?path=${p}&qs=${S}`;this.worker.postMessage({type:"connect",data:{url:T}}),this.worker.onmessage=A=>{this.handleWorkerMessage(A.data)}}sendEvent(e,t={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",event:e,params:t}})}sendEventTo(e,t,r={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",stateful_id:e,event:t,params:r}})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1,this.hierarchical.clear()}handleWorkerMessage(e){let{type:t,data:r}=e;try{switch(t){case"status":this.handleStatus(r);break;case"html_patch":this.handleHtmlPatch(r);break;case"error":this.handleWorkerError(r);break;case"reload":this.handleReload(r);break;case"reply":this.handleReply(r);break;case"redirect":this.handleRedirect(r);break;default:this.handleUnknownMessage(e)}}catch(i){this.error("Error handling worker message:",i)}}handleStatus(e){e.status==="connected"?(this.connected=!0,this.info("Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,this.info("Disconnected from WebSocket")),this.dispatchArizonaEvent("status",e)}handleHtmlPatch(e){let{patch:t,isInitial:r}=e;r?this.handleInitialRender(t):this.handleDiffPatch(t)}handleInitialRender(e){this.debug("Applying initial render"),e.structure&&this.hierarchical.initialize(e.structure),this.applyHtmlPatch(e)}handleDiffPatch(e){this.debug("Applying diff patch"),this.applyHtmlPatch(e)}applyHtmlPatch(e){let t=document.getElementById(e.statefulId);if(!t){this.warning(`Target element not found: ${e.statefulId}`);return}try{te(t,e.html,{onBeforeElUpdated(r,i){return!r.isEqualNode(i)}}),this.debug("Patch applied successfully"),t.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e}}))}catch(r){this.error("Error applying HTML patch:",r)}}handleWorkerError(e){this.error("Worker Error:",e.error),this.dispatchArizonaEvent("error",e)}handleReload(e){switch(e.file_type){case"css":this.info("CSS file changed. Refreshing stylesheets without page reload..."),document.querySelectorAll('link[rel="stylesheet"]').forEach(t=>{let r=t.href.split("?")[0];t.href=`${r}?t=${Date.now()}`});break;default:this.info(`${e.file_type||"File"} changed. Reloading page...`),window.location.reload()}}handleReply(e){this.debug("WebSocket reply:",e),this.dispatchArizonaEvent("reply",e)}handleRedirect(e){this.info("Redirecting to:",e.url),this.dispatchArizonaEvent("redirect",e),window.open(e.url,e.options?.target,e.options?.window_features)}handleUnknownMessage(e){this.warning("Unknown worker message:",e)}dispatchArizonaEvent(e,t){document.dispatchEvent(new CustomEvent("arizonaEvent",{detail:{type:e,data:t}}))}isConnected(){return this.connected}error(e,...t){console.error(`[Arizona] ${e}`,...t)}warning(e,...t){this.logLevel>=k.warning&&console.warn(`[Arizona] ${e}`,...t)}info(e,...t){this.logLevel>=k.info&&console.log(`[Arizona] ${e}`,...t)}debug(e,...t){this.logLevel>=k.debug&&console.log(`[Arizona] ${e}`,...t)}};export{F as default};
//# sourceMappingURL=arizona.min.js.map
