var X=11;function oe(a,e){var t=e.attributes,r,n,c,u,g;if(!(e.nodeType===X||a.nodeType===X)){for(var d=t.length-1;d>=0;d--)r=t[d],n=r.name,c=r.namespaceURI,u=r.value,c?(n=r.localName||n,g=a.getAttributeNS(c,n),g!==u&&(r.prefix==="xmlns"&&(n=r.name),a.setAttributeNS(c,n,u))):(g=a.getAttribute(n),g!==u&&a.setAttribute(n,u));for(var v=a.attributes,T=v.length-1;T>=0;T--)r=v[T],n=r.name,c=r.namespaceURI,c?(n=r.localName||n,e.hasAttributeNS(c,n)||a.removeAttributeNS(c,n)):e.hasAttribute(n)||a.removeAttribute(n)}}var C,le="http://www.w3.org/1999/xhtml",p=typeof document>"u"?void 0:document,ue=!!p&&"content"in p.createElement("template"),fe=!!p&&p.createRange&&"createContextualFragment"in p.createRange();function he(a){var e=p.createElement("template");return e.innerHTML=a,e.content.childNodes[0]}function de(a){C||(C=p.createRange(),C.selectNode(p.body));var e=C.createContextualFragment(a);return e.childNodes[0]}function pe(a){var e=p.createElement("body");return e.innerHTML=a,e.childNodes[0]}function ve(a){return a=a.trim(),ue?he(a):fe?de(a):pe(a)}function P(a,e){var t=a.nodeName,r=e.nodeName,n,c;return t===r?!0:(n=t.charCodeAt(0),c=r.charCodeAt(0),n<=90&&c>=97?t===r.toUpperCase():c<=90&&n>=97?r===t.toUpperCase():!1)}function ge(a,e){return!e||e===le?p.createElement(a):p.createElementNS(e,a)}function ye(a,e){for(var t=a.firstChild;t;){var r=t.nextSibling;e.appendChild(t),t=r}return e}function W(a,e,t){a[t]!==e[t]&&(a[t]=e[t],a[t]?a.setAttribute(t,""):a.removeAttribute(t))}var q={OPTION:function(a,e){var t=a.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(a.hasAttribute("selected")&&!e.selected&&(a.setAttribute("selected","selected"),a.removeAttribute("selected")),t.selectedIndex=-1)}W(a,e,"selected")},INPUT:function(a,e){W(a,e,"checked"),W(a,e,"disabled"),a.value!==e.value&&(a.value=e.value),e.hasAttribute("value")||a.removeAttribute("value")},TEXTAREA:function(a,e){var t=e.value;a.value!==t&&(a.value=t);var r=a.firstChild;if(r){var n=r.nodeValue;if(n==t||!t&&n==a.placeholder)return;r.nodeValue=t}},SELECT:function(a,e){if(!e.hasAttribute("multiple")){for(var t=-1,r=0,n=a.firstChild,c,u;n;)if(u=n.nodeName&&n.nodeName.toUpperCase(),u==="OPTGROUP")c=n,n=c.firstChild;else{if(u==="OPTION"){if(n.hasAttribute("selected")){t=r;break}r++}n=n.nextSibling,!n&&c&&(n=c.nextSibling,c=null)}a.selectedIndex=t}}},O=1,Y=11,Q=3,Z=8;function A(){}function Se(a){if(a)return a.getAttribute&&a.getAttribute("id")||a.id}function me(a){return function(t,r,n){if(n||(n={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var c=r;r=p.createElement("html"),r.innerHTML=c}else r=ve(r);else r.nodeType===Y&&(r=r.firstElementChild);var u=n.getNodeKey||Se,g=n.onBeforeNodeAdded||A,d=n.onNodeAdded||A,v=n.onBeforeElUpdated||A,T=n.onElUpdated||A,re=n.onBeforeNodeDiscarded||A,M=n.onNodeDiscarded||A,ne=n.onBeforeElChildrenUpdated||A,ae=n.skipFromChildren||A,$=n.addChild||function(i,s){return i.appendChild(s)},U=n.childrenOnly===!0,w=Object.create(null),x=[];function N(i){x.push(i)}function G(i,s){if(i.nodeType===O)for(var f=i.firstChild;f;){var o=void 0;s&&(o=u(f))?N(o):(M(f),f.firstChild&&G(f,s)),f=f.nextSibling}}function H(i,s,f){re(i)!==!1&&(s&&s.removeChild(i),M(i),G(i,f))}function j(i){if(i.nodeType===O||i.nodeType===Y)for(var s=i.firstChild;s;){var f=u(s);f&&(w[f]=s),j(s),s=s.nextSibling}}j(t);function R(i){d(i);for(var s=i.firstChild;s;){var f=s.nextSibling,o=u(s);if(o){var l=w[o];l&&P(s,l)?(s.parentNode.replaceChild(l,s),D(l,s)):R(s)}else R(s);s=f}}function ie(i,s,f){for(;s;){var o=s.nextSibling;(f=u(s))?N(f):H(s,i,!0),s=o}}function D(i,s,f){var o=u(s);if(o&&delete w[o],!f){var l=v(i,s);if(l===!1||(l instanceof HTMLElement&&(i=l,j(i)),a(i,s),T(i),ne(i,s)===!1))return}i.nodeName!=="TEXTAREA"?se(i,s):q.TEXTAREA(i,s)}function se(i,s){var f=ae(i,s),o=s.firstChild,l=i.firstChild,b,y,k,I,S;e:for(;o;){for(I=o.nextSibling,b=u(o);!f&&l;){if(k=l.nextSibling,o.isSameNode&&o.isSameNode(l)){o=I,l=k;continue e}y=u(l);var z=l.nodeType,m=void 0;if(z===o.nodeType&&(z===O?(b?b!==y&&((S=w[b])?k===S?m=!1:(i.insertBefore(S,l),y?N(y):H(l,i,!0),l=S,y=u(l)):m=!1):y&&(m=!1),m=m!==!1&&P(l,o),m&&D(l,o)):(z===Q||z==Z)&&(m=!0,l.nodeValue!==o.nodeValue&&(l.nodeValue=o.nodeValue))),m){o=I,l=k;continue e}y?N(y):H(l,i,!0),l=k}if(b&&(S=w[b])&&P(S,o))f||$(i,S),D(S,o);else{var E=g(o);E!==!1&&(E&&(o=E),o.actualize&&(o=o.actualize(i.ownerDocument||p)),$(i,o),R(o))}o=I,l=k}ie(i,l,y);var K=q[i.nodeName];K&&K(i,s)}var h=t,L=h.nodeType,J=r.nodeType;if(!U){if(L===O)J===O?P(t,r)||(M(t),h=ye(t,ge(r.nodeName,r.namespaceURI))):h=r;else if(L===Q||L===Z){if(J===L)return h.nodeValue!==r.nodeValue&&(h.nodeValue=r.nodeValue),h;h=r}}if(h===r)M(t);else{if(r.isSameNode&&r.isSameNode(h))return;if(D(h,r,U),x)for(var _=0,ce=x.length;_<ce;_++){var V=w[x[_]];V&&H(V,V.parentNode,!1)}}return!U&&h!==t&&t.parentNode&&(h.actualize&&(h=h.actualize(t.ownerDocument||p)),t.parentNode.replaceChild(h,t)),h}}var Ae=me(oe),ee=Ae;var B=class{constructor(){this.structure={}}initialize(e){this.structure=JSON.parse(JSON.stringify(e))}applyDiff(e,t){this.structure[e]||console.warn(`[Arizona] StatefulId ${e} not found in structure`);for(let[r,n]of t)this.structure[e].dynamic[r-1]=n}generateHTML(e){let t=this.structure[e];return t?this.zipStaticDynamic(t.static,t.dynamic):""}zipStaticDynamic(e,t){let r=[],n=Math.max(e.length,t.length);for(let c=0;c<n;c++)c<e.length&&r.push(e[c]),c<t.length&&r.push(this.normalizeDynamicElement(t[c]));return r.join("")}normalizeDynamicElement(e){return typeof e=="string"?e:e&&e.type==="stateful"?this.generateHTML(e.id):e&&e.type==="stateless"?this.generateHTMLFromStructure(e.structure):e&&e.type==="list"?this.generateListHTML(e):Array.isArray(e)?this.flattenIoData(e):String(e)}flattenIoData(e){return typeof e=="string"?e:typeof e=="number"?String(e):Array.isArray(e)?e.map(t=>this.flattenIoData(t)).join(""):e&&typeof e=="object"?e.type==="stateful"?this.generateHTML(e.id):e.type==="stateless"?this.generateHTMLFromStructure(e.structure):e.type==="list"?this.generateListHTML(e):String(e):String(e||"")}generateHTMLFromStructure(e){let t=[],r=Object.keys(e).map(n=>parseInt(n)).sort((n,c)=>n-c);for(let n of r){let c=e[n];typeof c=="string"?t.push(c):Array.isArray(c)?t.push(this.flattenIoData(c)):t.push(String(c))}return t.join("")}generateListHTML(e){let{static:t,dynamic:r}=e,n=[];for(let c of r){let u=[],g=Object.keys(c).map(v=>parseInt(v)).sort((v,T)=>v-T),d=0;for(let v of g)d<t.length&&(u.push(t[d]),d++),u.push(String(c[v]));for(;d<t.length;)u.push(t[d]),d++;n.push(u.join(""))}return n.join("")}getStructure(){return JSON.parse(JSON.stringify(this.structure))}isInitialized(){return Object.keys(this.structure).length>0}getComponent(e){return this.structure[e]||null}hasComponent(e){return e in this.structure}getComponentIds(){return Object.keys(this.structure)}clear(){this.structure={}}createPatch(e){return{type:"html_patch",statefulId:e,html:this.generateHTML(e),timestamp:Date.now()}}createInitialPatch(e){return{type:"initial_render",statefulId:e,html:this.generateHTML(e),structure:this.getStructure(),timestamp:Date.now()}}};var te=B;var F=class{constructor(){this.worker=null,this.connected=!1,this.hierarchical=new te}connect(e={}){if(this.connected)return;let t=e.wsPath||"/live/websocket",r=e.workerPath||"/assets/js/arizona-worker.min.js";this.worker=new Worker(r,{type:"module"});let n=window.location.protocol==="https:"?"wss:":"ws:",c=window.location.host,u=window.location.pathname,g=encodeURIComponent(u),d=`${n}//${c}${t}?path=${g}`;this.worker.postMessage({type:"connect",data:{url:d}}),this.worker.onmessage=v=>{this.handleWorkerMessage(v.data)}}sendEvent(e,t={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",event:e,params:t}})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1,this.hierarchical.clear()}handleWorkerMessage(e){let{type:t,data:r}=e;try{switch(t){case"status":this.handleStatus(r);break;case"html_patch":this.handleHtmlPatch(r);break;case"error":this.handleWorkerError(r);break;case"message":this.handleWebSocketMessage(r);break;default:console.warn("[Arizona] Unknown worker message type:",t);break}}catch(n){console.error("[Arizona] Error handling worker message:",n)}}handleStatus(e){e.status==="connected"?(this.connected=!0,console.log("[Arizona] Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,console.log("[Arizona] Disconnected from WebSocket"))}handleHtmlPatch(e){let{patch:t,isInitial:r}=e;r?this.handleInitialRender(t):this.handleDiffPatch(t)}handleInitialRender(e){console.log("[Arizona] Applying initial render"),e.structure&&this.hierarchical.initialize(e.structure),this.applyHtmlPatch(e)}handleDiffPatch(e){console.log("[Arizona] Applying diff patch"),this.applyHtmlPatch(e)}applyHtmlPatch(e){let t=document.getElementById(e.statefulId);if(!t){console.warn(`[Arizona] Target element not found: ${e.statefulId}`);return}try{ee(t,e.html,{onBeforeElUpdated(r,n){return!r.isEqualNode(n)}}),console.log("[Arizona] Patch applied successfully"),t.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e}}))}catch(r){console.error("[Arizona] Error applying HTML patch:",r)}}handleWorkerError(e){console.error("[Arizona Worker Error]:",e.error)}handleWebSocketMessage(e){console.log("[Arizona] WebSocket message:",e)}getHierarchicalStructure(){return this.hierarchical.getStructure()}isConnected(){return this.connected}};export{F as default};
//# sourceMappingURL=arizona.min.js.map
