var Q=11;function le(a,e){var t=e.attributes,n,r,c,f,v;if(!(e.nodeType===Q||a.nodeType===Q)){for(var b=t.length-1;b>=0;b--)n=t[b],r=n.name,c=n.namespaceURI,f=n.value,c?(r=n.localName||r,v=a.getAttributeNS(c,r),v!==f&&(n.prefix==="xmlns"&&(r=n.name),a.setAttributeNS(c,r,f))):(v=a.getAttribute(r),v!==f&&a.setAttribute(r,f));for(var T=a.attributes,y=T.length-1;y>=0;y--)n=T[y],r=n.name,c=n.namespaceURI,c?(r=n.localName||r,e.hasAttributeNS(c,r)||a.removeAttributeNS(c,r)):e.hasAttribute(r)||a.removeAttribute(r)}}var _,de="http://www.w3.org/1999/xhtml",u=typeof document>"u"?void 0:document,ce=!!u&&"content"in u.createElement("template"),oe=!!u&&u.createRange&&"createContextualFragment"in u.createRange();function fe(a){var e=u.createElement("template");return e.innerHTML=a,e.content.childNodes[0]}function he(a){_||(_=u.createRange(),_.selectNode(u.body));var e=_.createContextualFragment(a);return e.childNodes[0]}function ue(a){var e=u.createElement("body");return e.innerHTML=a,e.childNodes[0]}function ve(a){return a=a.trim(),ce?fe(a):oe?he(a):ue(a)}function D(a,e){var t=a.nodeName,n=e.nodeName,r,c;return t===n?!0:(r=t.charCodeAt(0),c=n.charCodeAt(0),r<=90&&c>=97?t===n.toUpperCase():c<=90&&r>=97?n===t.toUpperCase():!1)}function pe(a,e){return!e||e===de?u.createElement(a):u.createElementNS(e,a)}function ge(a,e){for(var t=a.firstChild;t;){var n=t.nextSibling;e.appendChild(t),t=n}return e}function F(a,e,t){a[t]!==e[t]&&(a[t]=e[t],a[t]?a.setAttribute(t,""):a.removeAttribute(t))}var Y={OPTION:function(a,e){var t=a.parentNode;if(t){var n=t.nodeName.toUpperCase();n==="OPTGROUP"&&(t=t.parentNode,n=t&&t.nodeName.toUpperCase()),n==="SELECT"&&!t.hasAttribute("multiple")&&(a.hasAttribute("selected")&&!e.selected&&(a.setAttribute("selected","selected"),a.removeAttribute("selected")),t.selectedIndex=-1)}F(a,e,"selected")},INPUT:function(a,e){F(a,e,"checked"),F(a,e,"disabled"),a.value!==e.value&&(a.value=e.value),e.hasAttribute("value")||a.removeAttribute("value")},TEXTAREA:function(a,e){var t=e.value;a.value!==t&&(a.value=t);var n=a.firstChild;if(n){var r=n.nodeValue;if(r==t||!t&&r==a.placeholder)return;n.nodeValue=t}},SELECT:function(a,e){if(!e.hasAttribute("multiple")){for(var t=-1,n=0,r=a.firstChild,c,f;r;)if(f=r.nodeName&&r.nodeName.toUpperCase(),f==="OPTGROUP")c=r,r=c.firstChild,r||(r=c.nextSibling,c=null);else{if(f==="OPTION"){if(r.hasAttribute("selected")){t=n;break}n++}r=r.nextSibling,!r&&c&&(r=c.nextSibling,c=null)}a.selectedIndex=t}}},N=1,J=11,Z=3,ee=8;function A(){}function we(a){if(a)return a.getAttribute&&a.getAttribute("id")||a.id}function Ae(a){return function(t,n,r){if(r||(r={}),typeof n=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var c=n;n=u.createElement("html"),n.innerHTML=c}else n=ve(n);else n.nodeType===J&&(n=n.firstElementChild);var f=r.getNodeKey||we,v=r.onBeforeNodeAdded||A,b=r.onNodeAdded||A,T=r.onBeforeElUpdated||A,y=r.onElUpdated||A,z=r.onBeforeNodeDiscarded||A,M=r.onNodeDiscarded||A,ne=r.onBeforeElChildrenUpdated||A,ae=r.skipFromChildren||A,K=r.addChild||function(i,s){return i.appendChild(s)},H=r.childrenOnly===!0,S=Object.create(null),O=[];function P(i){O.push(i)}function X(i,s){if(i.nodeType===N)for(var o=i.firstChild;o;){var l=void 0;s&&(l=f(o))?P(l):(M(o),o.firstChild&&X(o,s)),o=o.nextSibling}}function R(i,s,o){z(i)!==!1&&(s&&s.removeChild(i),M(i),X(i,o))}function $(i){if(i.nodeType===N||i.nodeType===J)for(var s=i.firstChild;s;){var o=f(s);o&&(S[o]=s),$(s),s=s.nextSibling}}$(t);function V(i){b(i);for(var s=i.firstChild;s;){var o=s.nextSibling,l=f(s);if(l){var d=S[l];d&&D(s,d)?(s.parentNode.replaceChild(d,s),L(d,s)):V(s)}else V(s);s=o}}function re(i,s,o){for(;s;){var l=s.nextSibling;(o=f(s))?P(o):R(s,i,!0),s=l}}function L(i,s,o){var l=f(s);if(l&&delete S[l],!o){var d=T(i,s);if(d===!1||(d instanceof HTMLElement&&(i=d,$(i)),a(i,s),y(i),ne(i,s)===!1))return}i.nodeName!=="TEXTAREA"?ie(i,s):Y.TEXTAREA(i,s)}function ie(i,s){var o=ae(i,s),l=s.firstChild,d=i.firstChild,k,p,m,E,g;e:for(;l;){for(E=l.nextSibling,k=f(l);!o&&d;){if(m=d.nextSibling,l.isSameNode&&l.isSameNode(d)){l=E,d=m;continue e}p=f(d);var C=d.nodeType,w=void 0;if(C===l.nodeType&&(C===N?(k?k!==p&&((g=S[k])?m===g?w=!1:(i.insertBefore(g,d),p?P(p):R(d,i,!0),d=g,p=f(d)):w=!1):p&&(w=!1),w=w!==!1&&D(d,l),w&&L(d,l)):(C===Z||C==ee)&&(w=!0,d.nodeValue!==l.nodeValue&&(d.nodeValue=l.nodeValue))),w){l=E,d=m;continue e}p?P(p):R(d,i,!0),d=m}if(k&&(g=S[k])&&D(g,l))o||K(i,g),L(g,l);else{var W=v(l);W!==!1&&(W&&(l=W),l.actualize&&(l=l.actualize(i.ownerDocument||u)),K(i,l),V(l))}l=E,d=m}re(i,d,p);var j=Y[i.nodeName];j&&j(i,s)}var h=t,x=h.nodeType,q=n.nodeType;if(!H){if(x===N)q===N?D(t,n)||(M(t),h=ge(t,pe(n.nodeName,n.namespaceURI))):h=n;else if(x===Z||x===ee){if(q===x)return h.nodeValue!==n.nodeValue&&(h.nodeValue=n.nodeValue),h;h=n}}if(h===n)M(t);else{if(n.isSameNode&&n.isSameNode(h))return;if(L(h,n,H),O)for(var B=0,se=O.length;B<se;B++){var I=S[O[B]];I&&R(I,I.parentNode,!1)}}return!H&&h!==t&&t.parentNode&&(h.actualize&&(h=h.actualize(t.ownerDocument||u)),t.parentNode.replaceChild(h,t)),h}}var be=Ae(le),te=be;var U={silent:-1,error:3,warning:4,info:6,debug:7},G=class{constructor(e={}){this.worker=null,this.connected=!1,this.logLevel=U[e.logLevel]??U.silent}connect(e={}){if(this.connected)return;let t=e.wsPath||"/live",n=e.workerPath||"/assets/js/arizona-worker.min.js";this.worker=new Worker(n,{type:"module"});let r=window.location.protocol==="https:"?"wss:":"ws:",c=window.location.host,f=window.location.pathname,v=window.location.search,b=encodeURIComponent(f),T=v?encodeURIComponent(v.substring(1)):"",y=`${r}//${c}${t}?path=${b}&qs=${T}`;this.worker.postMessage({type:"connect",data:{url:y}}),this.worker.onmessage=z=>{this.handleWorkerMessage(z.data)}}sendEvent(e,t={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",event:e,params:t}})}sendEventTo(e,t,n={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",stateful_id:e,event:t,params:n}})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1}handleWorkerMessage(e){let{type:t,data:n}=e;try{switch(t){case"status":this.handleStatus(n);break;case"initial_render":break;case"html_patch":this.handleHtmlPatch(n);break;case"error":this.handleWorkerError(n);break;case"reload":this.handleReload(n);break;case"reply":this.handleReply(n);break;case"redirect":this.handleRedirect(n);break;default:this.handleUnknownMessage(e)}}catch(r){this.error("Error handling worker message:",r)}}handleStatus(e){e.status==="connected"?(this.connected=!0,this.info("Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,this.info("Disconnected from WebSocket")),this.dispatchArizonaEvent("status",e)}handleHtmlPatch(e){this.debug("Applying HTML patch"),this.applyHtmlPatch(e.patch)}applyHtmlPatch(e){let t=document.getElementById(e.statefulId);if(!t){this.warning(`Target element not found: ${e.statefulId}`);return}try{te(t,e.html,{onBeforeElUpdated(n,r){return r.dataset?.arizonaUpdate==="false"?!1:!n.isEqualNode(r)}}),this.debug("Patch applied successfully"),t.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e}}))}catch(n){this.error("Error applying HTML patch:",n)}}handleWorkerError(e){this.error("Worker Error:",e.error),this.dispatchArizonaEvent("error",e)}handleReload(e){switch(e.file_type){case"css":this.info("CSS file changed. Refreshing stylesheets without page reload..."),document.querySelectorAll('link[rel="stylesheet"]').forEach(t=>{let n=t.href.split("?")[0];t.href=`${n}?t=${Date.now()}`});break;default:this.info(`${e.file_type||"File"} changed. Reloading page...`),window.location.reload()}}handleReply(e){this.debug("WebSocket reply:",e),this.dispatchArizonaEvent("reply",e)}handleRedirect(e){this.info("Redirecting to:",e.url),this.dispatchArizonaEvent("redirect",e),window.open(e.url,e.options?.target,e.options?.window_features)}handleUnknownMessage(e){this.warning("Unknown worker message:",e)}dispatchArizonaEvent(e,t){document.dispatchEvent(new CustomEvent("arizonaEvent",{detail:{type:e,data:t}}))}isConnected(){return this.connected}error(e,...t){console.error(`[Arizona] ${e}`,...t)}warning(e,...t){this.logLevel>=U.warning&&console.warn(`[Arizona] ${e}`,...t)}info(e,...t){this.logLevel>=U.info&&console.log(`[Arizona] ${e}`,...t)}debug(e,...t){this.logLevel>=U.debug&&console.log(`[Arizona] ${e}`,...t)}};export{G as default};
//# sourceMappingURL=arizona.min.js.map
