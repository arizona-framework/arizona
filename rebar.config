{minimum_otp_vsn, "28"}.

{erl_first_files, [
    "src/arizona_token.erl",
    "src/arizona_scanner.erl",
    "src/arizona_markdown.erl",
    "src/arizona_markdown_processor.erl",
    "src/arizona_parser.erl"
]}.

{erl_opts, [
    debug_info,
    warnings_as_errors,
    warn_missing_spec
]}.

{deps, [
    {eqwalizer_support,
        {git_subdir, "https://github.com/whatsapp/eqwalizer.git", {branch, "main"},
            "eqwalizer_support"}},
    {markdown,
        {git_subdir, "https://github.com/arizona-framework/erlang-markdown.git", {branch, "main"},
            "apps/markdown"}},
    {cowboy, "2.14.2"},
    {fs, "11.4.1"}
]}.

% See https://github.com/ninenines/cowboy/issues/1670
{overrides, [{override, cowboy, [{deps, [{cowlib, "~> 2.15"}, {ranch, "~> 2.0"}]}]}]}.

{dialyzer, [
    {plt_apps, all_deps},
    {plt_extra_apps, [
        compiler,
        common_test,
        eunit,
        inets,
        markdown,
        syntax_tools
    ]},
    {warnings, [
        unknown,
        unmatched_returns
    ]},
    incremental
]}.

{alias, [
    {check, [
        {fmt, "--check"},
        lint,
        hank,
        xref,
        {do, "default as test dialyzer"}
    ]},
    {test, [
        {eunit, "--cover"},
        {ct, "--cover"},
        {cover, "--min_coverage 80 --verbose"},
        ex_doc
    ]},
    {ci, [
        check,
        {do, "default as test test"}
    ]}
]}.

{profiles, [
    {default, [
        {xref_checks, [
            exports_not_used
        ]}
    ]},
    {debug, [
        {erl_opts, [
            debug_info,
            nowarn_missing_spec,
            {d, 'DEBUG'},
            {d, 'TEST'}
        ]},
        {extra_src_dirs, [{"test", [{recursive, true}]}]},
        {xref_checks, []}
    ]},
    {test, [
        {cover_enabled, true},
        {cover_opts, [verbose]},
        {erl_opts, [
            debug_info,
            nowarn_missing_spec,
            warnings_as_errors
        ]},
        {deps, [
            % gun is required for WebSocket tests
            {gun, "2.2.0"}
        ]},
        {dialyzer, [
            {plt_apps, all_deps},
            {plt_extra_apps, [
                compiler,
                common_test,
                eunit,
                inets,
                markdown,
                syntax_tools,
                gun,
                fs
            ]},
            {warnings, [
                unknown,
                unmatched_returns
            ]},
            incremental
        ]},
        {extra_src_dirs, [{"test", [{recursive, true}]}]},
        {xref_checks, []}
    ]}
]}.

{project_plugins, [
    {rebar3_hex, "7.0.11"},
    {erlfmt, "1.7.0"},
    {rebar3_lint, "4.2.2"},
    {rebar3_hank, "1.4.1"},
    {rebar3_ex_doc, "0.2.31"}
]}.

{shell, [
    {apps, [arizona]},
    {app_reload_blacklist, [ranch]}
]}.

{erlfmt, [
    write,
    {files, [
        "elvis.config",
        "rebar.config",
        "src/*.app.src",
        "src/**/*.erl",
        "test/**/*.erl"
    ]}
]}.

{ex_doc, [
    {extras, [
        "README.md",
        "SECURITY.md",
        "CODE_OF_CONDUCT.md",
        "CONTRIBUTING.md",
        "LICENSE.md",
        "CHANGELOG.md",
        %% Getting Started
        "docs/getting-started/installation.md",
        "docs/getting-started/quick-start.md",
        "docs/getting-started/project-structure.md",
        %% Templates
        "docs/templates/overview.md",
        "docs/templates/html.md",
        "docs/templates/erlang-terms.md",
        "docs/templates/markdown.md",
        "docs/templates/bindings.md",
        %% Components
        "docs/components/overview.md",
        "docs/components/views.md",
        "docs/components/stateful.md",
        "docs/components/stateless.md",
        "docs/components/layouts.md",
        "docs/components/slots.md",
        "docs/components/collections.md",
        %% Events
        "docs/events/overview.md",
        "docs/events/websocket-events.md",
        "docs/events/call-events.md",
        "docs/events/pubsub.md",
        "docs/events/client-events.md",
        %% Actions
        "docs/actions/actions.md",
        %% Server
        "docs/server/configuration.md",
        "docs/server/routing.md",
        "docs/server/middleware.md",
        "docs/server/plugins.md",
        %% JavaScript Client
        "docs/javascript-client/setup.md",
        "docs/javascript-client/logging.md",
        %% Deployment
        "docs/deployment/production.md",
        "docs/deployment/static-site.md",
        %% Development
        "docs/development/file-watching.md",
        "docs/development/smart-reload.md",
        %% Ecosystem
        "docs/ecosystem/editor-support.md",
        "docs/ecosystem/examples.md"
    ]},
    {groups_for_extras, [
        {~"Getting Started", [
            ~"docs/getting-started/installation.md",
            ~"docs/getting-started/quick-start.md",
            ~"docs/getting-started/project-structure.md"
        ]},
        {~"Templates", [
            ~"docs/templates/overview.md",
            ~"docs/templates/html.md",
            ~"docs/templates/erlang-terms.md",
            ~"docs/templates/markdown.md",
            ~"docs/templates/bindings.md"
        ]},
        {~"Components", [
            ~"docs/components/overview.md",
            ~"docs/components/views.md",
            ~"docs/components/stateful.md",
            ~"docs/components/stateless.md",
            ~"docs/components/layouts.md",
            ~"docs/components/slots.md",
            ~"docs/components/collections.md"
        ]},
        {~"Events", [
            ~"docs/events/overview.md",
            ~"docs/events/websocket-events.md",
            ~"docs/events/call-events.md",
            ~"docs/events/pubsub.md",
            ~"docs/events/client-events.md"
        ]},
        {~"Actions", [
            ~"docs/actions/actions.md"
        ]},
        {~"Server", [
            ~"docs/server/configuration.md",
            ~"docs/server/routing.md",
            ~"docs/server/middleware.md",
            ~"docs/server/plugins.md"
        ]},
        {~"JavaScript Client", [
            ~"docs/javascript-client/setup.md",
            ~"docs/javascript-client/logging.md"
        ]},
        {~"Deployment", [
            ~"docs/deployment/production.md",
            ~"docs/deployment/static-site.md"
        ]},
        {~"Development", [
            ~"docs/development/file-watching.md",
            ~"docs/development/smart-reload.md"
        ]},
        {~"Ecosystem", [
            ~"docs/ecosystem/editor-support.md",
            ~"docs/ecosystem/examples.md"
        ]}
    ]},
    {main, "README.md"},
    {api_reference, false},
    {source_url, "https://github.com/arizona-framework/arizona"},
    {prefix_ref_vsn_with_v, false}
]}.

{hex, [{doc, #{provider => ex_doc}}]}.
